<!DOCTYPE html>
<html lang="en">
<head>
        <title>A notch above a monkey - shell</title>
        <meta charset="utf-8" />
        <link rel="shortcut icon" href="theme/img/markos.ico" />

        <link href="http://fast.fonts.com/cssapi/aee9b60b-8e94-47f8-b586-3ecbfab51d1c.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" type="text/css" href="theme/css/home.css" media="screen" title="Light theme" />
        <link rel="alternate stylesheet" type="text/css" href="theme/css/home_dark.css" media="screen" title="Dark theme" />
        <link rel="stylesheet" href="theme/css/ipad.css" media="only screen and (min-device-width : 768px) and (max-device-width : 1024px)">
        <link rel="stylesheet" type="text/css" href="theme/css/smallscreen.css" media="only screen and (max-width: 700px)" />

        <link href="/articles/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="A notch above a monkey Full Atom Feed" />
        <link href="/articles/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="A notch above a monkey Full RSS Feed" />
</head>

<body>


<section class="envelope posts">
    <header>
        <h1><a href="http://markos.gaivo.net/articles/">A notch above a monkey <strong></strong></a></h1>
    </header><!-- /#banner -->

    <nav class="colophon">
        <h1>By Marko Samastur</h1>
        <ul>
            <li><a href="/">About me</a></li>
            <li><a href="/articles/feeds/atom.xml">Subscribe</a></li>
        </ul>
    </nav>

        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="http://markos.gaivo.net/articles/subtracting-sets-to-get-non-referenced-rows-in-table.html" rel="bookmark" title="Permalink to Subtracting sets to get non-referenced rows in table.">Subtracting sets to get non-referenced rows in table.</a></h1>

            <div class="entry-content post-text">
                <p><html>
 <body>
  <div>
   <p>
    I had a problem today. Given two database tables with first having a foreign key pointing to second, find those rows in second table, which are not pointed to from first. Well, it was slightly more complicated than this, but this was the tricky part.
   </p>
   <p>
    I tried to solve my problem using
    <a href="http://en.wikipedia.org/wiki/SQL" title="SQL description on Wikipedia">
     SQL
    </a>
    , but I could not. I am not saying it can’t be done, but with my limited knowledge of SQL I could not produce a query that would not perform horribly. Working on production database under heavy use made this a real no-go.
   </p>
   <p>
    After trying to come up with pure solution I finally gave up and decided to solve this problem pragmatically with some scripting. Turns out that too was more complicated than necessary. Unix shell tools are all you actually need, provided your dataset is not too big for your computer limitations (mostly memory).
   </p>
   <p>
    Instead of searching for those rows directly, I changed my plan to create two sets of rows, first containing all possible candidates and second containing those from first set which are pointed to from first table. Subtracting second set from first would therefore give me exactly those rows which aren’t pointed to.
   </p>
   <p>
    If file
    <em>
     all
    </em>
    contains a row-per-line list of all candidates and
    <em>
     linked
    </em>
    a similar list of those that are linked to, then you can get non-linked by running following command:
   </p>
   <p>
    <code>
     cat all linked | sort | uniq -u &gt; non_linked
    </code>
   </p>
   <p>
    What this does is following.
    <em>
     Sort
    </em>
    will put duplicated rows together and
    <em>
     -u
    </em>
    option of
    <em>
     uniq
    </em>
    will display only unique lines which are those that can be found only in
    <em>
     all
    </em>
    . Problem solved.
   </p>
  </div>
 </body>
</html></p>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2012-10-02T00:07:00+02:00">Tue 02 October 2012</time> </li>
                    <li><a href="http://markos.gaivo.net/articles/subtracting-sets-to-get-non-referenced-rows-in-table.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>
        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="http://markos.gaivo.net/articles/subtracting-sets-to-get-non-referenced-rows-in-table.html" rel="bookmark" title="Permalink to Subtracting sets to get non-referenced rows in table.">Subtracting sets to get non-referenced rows in table.</a></h1>

            <div class="entry-content post-text">
                <p><html>
 <body>
  <div>
   <p>
    I had a problem today. Given two database tables with first having a foreign key pointing to second, find those rows in second table, which are not pointed to from first. Well, it was slightly more complicated than this, but this was the tricky part.
   </p>
   <p>
    I tried to solve my problem using
    <a href="http://en.wikipedia.org/wiki/SQL" title="SQL description on Wikipedia">
     SQL
    </a>
    , but I could not. I am not saying it can’t be done, but with my limited knowledge of SQL I could not produce a query that would not perform horribly. Working on production database under heavy use made this a real no-go.
   </p>
   <p>
    After trying to come up with pure solution I finally gave up and decided to solve this problem pragmatically with some scripting. Turns out that too was more complicated than necessary. Unix shell tools are all you actually need, provided your dataset is not too big for your computer limitations (mostly memory).
   </p>
   <p>
    Instead of searching for those rows directly, I changed my plan to create two sets of rows, first containing all possible candidates and second containing those from first set which are pointed to from first table. Subtracting second set from first would therefore give me exactly those rows which aren’t pointed to.
   </p>
   <p>
    If file
    <em>
     all
    </em>
    contains a row-per-line list of all candidates and
    <em>
     linked
    </em>
    a similar list of those that are linked to, then you can get non-linked by running following command:
   </p>
   <p>
    <code>
     cat all linked | sort | uniq -u &gt; non_linked
    </code>
   </p>
   <p>
    What this does is following.
    <em>
     Sort
    </em>
    will put duplicated rows together and
    <em>
     -u
    </em>
    option of
    <em>
     uniq
    </em>
    will display only unique lines which are those that can be found only in
    <em>
     all
    </em>
    . Problem solved.
   </p>
  </div>
 </body>
</html></p>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2012-10-02T00:07:00+02:00">Tue 02 October 2012</time> </li>
                    <li><a href="http://markos.gaivo.net/articles/subtracting-sets-to-get-non-referenced-rows-in-table.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>

<p class="paginator">
    Page 1 / 1
</p>
</section><!-- /#content -->

    <footer>
        <ul>
            <li>&copy; 2005-2015 Marko Samastur</li>
            <li><a href="/articles/feeds/rss.xml" rel="alternate" title="A notch above a monkey Full RSS Feed">Entries feed</a></li>
        </ul>
        <a href="/"><img src="/img/markos_light_small_bg.png" alt="logo" class="mini-logo" /></a>
    </footer>
</body>
</html>