<!DOCTYPE html>
<html lang="en">
<head>
        <title>A notch above a monkey - Articles by markos</title>
        <meta charset="utf-8" />
				<meta name="viewport" content="width=device-width, initial-scale=1">

				<link rel="shortcut icon" href="/articles/theme/favicon/favicon.ico" />
				<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/articles/theme/favicon/apple-touch-icon-57x57.png" />
				<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/articles/theme/favicon/apple-touch-icon-114x114.png" />
				<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/articles/theme/favicon/apple-touch-icon-72x72.png" />
				<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/articles/theme/favicon/apple-touch-icon-144x144.png" />
				<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/articles/theme/favicon/apple-touch-icon-60x60.png" />
				<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/articles/theme/favicon/apple-touch-icon-120x120.png" />
				<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/articles/theme/favicon/apple-touch-icon-76x76.png" />
				<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/articles/theme/favicon/apple-touch-icon-152x152.png" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-196x196.png" sizes="196x196" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-96x96.png" sizes="96x96" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-32x32.png" sizes="32x32" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-16x16.png" sizes="16x16" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-128.png" sizes="128x128" />
				<meta name="application-name" content="Marko Samastur"/>
				<meta name="msapplication-TileColor" content="#FBF8E9" />
				<meta name="msapplication-TileImage" content="/articles/theme/favicon/mstile-144x144.png" />
				<meta name="msapplication-square70x70logo" content="/articles/theme/favicon/mstile-70x70.png" />
				<meta name="msapplication-square150x150logo" content="/articles/theme/favicon/mstile-150x150.png" />
				<meta name="msapplication-wide310x150logo" content="/articles/theme/favicon/mstile-310x150.png" />
				<meta name="msapplication-square310x310logo" content="/articles/theme/favicon/mstile-310x310.png" />

        <style>
/*
 * Icecream theme by Marko Samastur (markos@gaivo.net)
 *
 *
 * Color palette:
 * - dark blue: #30303c
 * - light yellow: fbf8e9
 * - link red: #980000
 * - link orange: #ffb665
 */
*{box-sizing:border-box}html,body{padding:0;margin:0;height:100%}body{position:relative;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:300;font-size:18px;line-height:1.333333}section,article,aside,header,footer{display:block}h1,h2,h3,h4,h5,h6{margin:1.5em 0;font-size:1.777777em;font-weight:200;line-height:1.5}a:visited,a{text-decoration:none}a:hover{text-decoration:underline}a img{border:0;margin-top:6px}img{max-width:100%}.envelope{position:relative;max-width:60em;width:calc(100% - 2em);margin:2em auto 0;padding:0 0 8em}body > footer{position:fixed;bottom:0;width:100%;height:6em;margin:0;padding:.5em 1em 0;font-size:.8em;text-align:center}body > footer ul{list-style-type:none;margin:0;padding:0}body > footer li{margin:.25em 0}@media (min-device-width:600px){body > footer{height:3em;text-align:left}body > footer ul{display:inline-block}body > footer li{display:inline-block;margin:.5em 2em 0 0}body > footer .mini-logo{float:right}}.about h1{margin:0}.about h2{margin-bottom:0}.about p{margin:1.333333em 0}aside{margin-bottom:2.666666em}aside .photo{max-width:100%;max-height:11.2em;margin:0 1em 8px 0;padding:3px}aside ul{list-style-type:none;margin:0 0 1.333333em;padding:0;overflow:hidden}aside .vcard li{float:none;margin:0}aside li{float:left;margin:.25em 8px 0 0.1em}aside p{margin:0}aside a.email{padding-left:20px;background:url(../img/email-16x16.png) no-repeat 0 0}aside a.website{padding-left:20px;background:url(../img/website-16x16.png) no-repeat 0 0}.elsewhere-links{padding:0 0 0 .5em;list-style-type:inherit}.elsewhere-links > li{float:none;list-style-type:'- '}@media (min-device-width:600px){aside{float:right;width:30%}.about{width:62%;max-width:60em}}body > header h1{font-size:1em;margin:0;padding:.666666em 1em;line-height:1}.post-text h2,.post-text h3{margin:1em 0;font-size:1.333333em;line-height:1}.post .entry-title{margin:1.3333333em 0 0}.post p{margin:1.333333em 0}.post .post-info ul{margin:0 0 2.666666em;padding-left:0}.post .post-info li{list-style-type:none}.post > footer li{font-variant:small-caps}@media (min-device-width:600px){.post .post-info{float:right;width:30%;margin-top:o}.post .post-info ul{margin-bottom:0}.post .post-text,.post #isso-thread{width:62%;max-width:60em}.post p:first-child{margin-top:0}}.posts h1{margin-bottom:0}.colophon h1{margin-top:0;font-size:1em;font-weight:300;line-height:1.333333;font-variant:small-caps}.colophon ul{list-style-type:none;margin:1.333333em 0;padding:0}.posts .entry-title{margin:2.666666em 0 0;font-size:1.333333em;line-height:1}.posts p{margin:1.333333em 0}.post-metadata ul{margin:1.333333em 0;padding-left:0;opacity:.8}.post-metadata li{list-style-type:none;display:inline-block;font-style:italic}.post-metadata li:first-child:after{content:" |"}.posts .paginator{margin-top:2.666666em;padding-left:0;text-align:center}.paginator li{list-style-type:none;display:inline-block;margin:0 .5em}@media (min-device-width:600px){.colophon{float:right;width:30%;margin-top:0}.hentry{width:62%;max-width:60em}nav + .hentry .entry-title{margin-top:0}}.error{text-align:left}.error img{max-width:100%;padding:3px}.imageR img{float:right;margin:.7em 0 .7em 1.5em;padding:3px}.imageL img{float:left;margin:.7em 1.5em .7em 0;padding:3px}.zemanta-related-title{font-size:1em;margin:2.8em 0 0}.zemanta-img .wp-caption{margin:0 0 0 1.5em}.zemanta-img img{padding:3px}.zemanta-pixie{display:none}.alignleft{float:left}.alignright{float:right}.aligncenter{text-align:center;max-width:100%}.alignleft img,img.alignleft,.alignright img,img.alignright,.aligncenter img,img.aligncenter{padding:3px}ol.code{font:normal 95%/110% Andale Mono,Courier,monospace;padding:5px;text-align:left}ol.code code{font:normal 98%/110% Andale Mono,Courier,monospace}.code li.tab1{padding-left:1em}.code li.tab2{padding-left:2em}.code li.tab3{padding-left:3em}.code li.tab4{padding-left:4em}.code li.tab5{padding-left:5em}.code li.tab6{padding-left:6em}.code li.download,.code li:nth-last-child(2){list-style-type:none}.highlight pre{overflow:auto}				</style>

				<style type="text/css" title="Light theme">
body {background-color: #fbf8e9;color: #30303c;}
body > footer a, body > footer a:visited {color: #ffb665;}
a, a:visited, a:hover {color: #980000;}
body > footer {background-color:#30303c;color:#fbf8e9;}
aside .photo, .error img, .alignleft img, img.alignleft, .alignright img, img.alignright, .aligncenter img, img.aligncenter,
.zemanta-img img, .imageR img, .imageL img {background-color:#fbf8e9;border:1px solid #30303c;}
.post header h1, .posts header h1, .posts > header h1 {border-bottom:1px solid #30303c;}
ol.code {border: 1px solid #30303c;}
body > footer .mini-logo {display: inline-block;width:97px;height:32px;border:0;background:url(theme/img/markos_dark_small_bg.png);overflow:hidden;text-indent:-400px;}
				</style>

				<style type="text/css" title="Dark theme">
body {background-color: #30303c;color: #fbf8e9;}
body > footer a, body > footer a:visited {color: #980000;}
a, a:visited, a:hover {color: #ffb665;}
body > footer {background-color:#fbf8e9;color:#30303c;}
aside .photo, .error img, .alignleft img, img.alignleft, .alignright img, img.alignright, .aligncenter img, img.aligncenter,
.zemanta-img img, .imageR img, .imageL img {background-color:#fbf8e9;}
.post header h1, .posts header h1, .posts > header h1 {border-bottom:1px solid #fbf8e9;}
ol.code {border: 1px solid #fbf8e9;}
body > footer .mini-logo {display: inline-block;width:97px;height:32px;border:0;background:url(theme/img/markos_light_small_bg.png);overflow:hidden;text-indent:-400px;}
				</style>

        <link href="/articles/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="A notch above a monkey Full Atom Feed" />
        <link href="/articles/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="A notch above a monkey Full RSS Feed" />
</head>

<body>

<h2>Articles by markos</h2>

<section class="envelope posts">
    <header>
        <h1><a href="../">A notch above a monkey <strong></strong></a></h1>
    </header><!-- /#banner -->

    <nav class="colophon">
        <h1>By Marko Samastur</h1>
        <ul>
            <li><a href="/">About me</a></li>
            <li><a href="/articles/feeds/atom.xml">Subscribe</a></li>
        </ul>
    </nav>

        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="../speeding-up-levenshtein.html" rel="bookmark" title="Permalink to Speeding up Levenshtein">Speeding up Levenshtein</a></h1>

            <div class="entry-content post-text">
                <div>
 <p>
  <a href="handling-404.html">
   Simon
  </a>
  proposes using a dictionary to match mistyped URLs with real ones. I’d probably like the idea better if I actually understood it. Still using
  <a href="http://en.wikipedia.org/wiki/Levenshtein_distance" title="description of the algorithm">
   Levenshtein
  </a>
  can be a bit easier than using a spell checker responsively.
 </p>
 <p>
  Easier, but slow. I used existing
  <a href="http://hetland.org/python/distance.py" title="python implementation">
   implementation
  </a>
  by Magnus Lie Hetland and made a test with 245 blog titles using a simple
  <a href="http://markos.gaivo.net/examples/distance/test_distance" title="Link to test script">
   script
  </a>
  . 100 iterations on aging powerbook produced:
 </p>
 <p style="text-indent:20pt;">
  1.766s, 29.152s, 9.399s (min, max, avg)
 </p>
 <p>
  Average time to calculate distance between randomly chosen title and rest of them is 9.4 seconds, which is far too much to be useful. And there’s not even 250 of them.
 </p>
 <p>
  There are two obvious ways to speed things up. Since minimum distance is at least as much as a difference in length of both strings, there’s no point in calculating it when difference already exceeds a limit we chose.
 </p>
 <p>
  The other trick took into an account that Levenshtein’s algorithm of two strings of comparable length has complexity of O(n2) and that my blog titles are form quite sparse space. If strings are longer than a certain limit (I arbitrarily chose 10 letters), then first calculate edit distance on a small sparse substring and then calculate the real distance only if first one was close enough.
 </p>
 <p>
  When I made 1000 iterations of randomly chosen title using only first test, I got following results:
 </p>
 <p style="text-indent:20pt;">
  0.003s, 0.284s, 0.167s (min, max, avg)
 </p>
 <p>
  However, if I used both checks, the same 1000 iteration test got me:
 </p>
 <p style="text-indent:20pt;">
  0.003s, 0.162s, 0.027s (min, max, avg)
 </p>
 <p>
  So,
  <a href="http://markos.gaivo.net/examples/distance/distance.py" title="Extended distance functions">
   two simple checks
  </a>
  can speed up search up to 350 times. Not bad, but I’m not happy. This is certainly fast enough for a personal website or sites where site structure effectively divides searching to relatively small sets of possible hits, but there are plenty of sites where it would be too slow.
 </p>
 <p>
  I tried to simplify searching using distance to map strings to coordinate system, which was at least hopelessly naive if not downright dumb. A much better approach would be to read more, which is what I’m doing now.
 </p>
 <p>
  By the way, I’ve also tried to speed it up using Pyrex, but got pretty much same results, which means I either don’t know how to use Pyrex or Python optimizes well. Or both.
 </p>
</div>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2006-11-10T02:17:00+01:00">Fri 10 November 2006</time> </li>
                    <li><a href="../speeding-up-levenshtein.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>
        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="../handling-404.html" rel="bookmark" title="Permalink to Handling 404">Handling 404</a></h1>

            <div class="entry-content post-text">
                <div>
 <p>
  This blog doesn’t use descriptive URLs, which is not the only time I screwed this up for no good reason. In this case it was mainly laziness and smug i-don’t-care-if-people-find-me attitude, but I hadn’t really realized how stupid this decision was until I started thinking about the problem of missing pages (error 404).
 </p>
 <p>
  It always bugged me how useless most 404 pages are. Sure, I could notify the webmaster about a broken link, but that won’t help me find what I’m looking for. Can’t we do better than that?
 </p>
 <p>
  As it happens we often can.  There’s an unlimited number of ways in which visitors can fail to reach their destination, but majority of them probably fall in four categories:
 </p>
 <ul>
  <li>
   content moved elsewhere
  </li>
  <li>
   broken links
  </li>
  <li>
   typos
  </li>
  <li>
   bad memory recall
  </li>
 </ul>
 <p>
  <strong>
   Content moved elsewhere
  </strong>
 </p>
 <p>
  Many believe that pages should be permanent and links shouldn’t break over time. Yet sometimes we either have little control over this or there are good reasons for breakage. We should still try to mitigate such situation by guiding visitors to correct new location when possible.
 </p>
 <p>
  This is done with HTTP redirects. If content was moved only temporary, then response should have a status code of 302 and contain a link in the header to correct current address. If move was permanent, then the same thing is achieved with code 301.
 </p>
 <p>
  Missing pages amount to around 0.6% of hits on this website. They would be around 8% if redirects weren’t used.
 </p>
 <p>
  <strong>
   Broken links
  </strong>
 </p>
 <p>
  Broken links appear when email clients break URL longer than maximum line length or from botched copy operation. This usually means that address is cut off and part we have is incomplete, but otherwise correct. Handling such links can range from trivial to impossible. Let’s look at one Wikipedia link as an example:
 </p>
 <p style="text-indent:20pt;">
  <a href="http://en.wikipedia.org/wiki/Longest_common_subsequence_problem" title="Link to article about longest common sequence problem">
   http://en.wikipedia.org/wiki/Longest_common_subsequence_problem
  </a>
 </p>
 <p>
  Let’s say that link was broken near the end of it and there was
  <em>
   lem
  </em>
  missing in
  <em>
   problem
  </em>
  . Resulting address might not be complete, but there probably aren’t that many Wikipedia articles where such string forms first part of their address and it would be reasonable to assume that Wikipedia could find the right article. Alas it doesn’t.
 </p>
 <p>
  On the other side of the spectrum are impossible or almost impossible guesses. If address was broken anywhere before
  <em>
   Longest
  </em>
  , then we could learn nothing from it about visitors expectations. This would look like a good place to give up.
 </p>
 <p>
  However, if we are lucky, then our visitors came from one of popular search engines, which means their referrer attribute includes search string that led to our page. We can extract those keywords, use them and hopefully find that page or failing that offer a list of related pages. Not perfect, but beats plain “Not here” sign.
 </p>
 <p>
  <strong>
   Typos
  </strong>
 </p>
 <p>
  Typos are what happens when people use keyboards. I can’t live without one, but I still recognize that my fingers and my brain are not always of the same mind about how to spell a word. Letters get added, dropped or just switch places, all being a problem for a program that usually looks for that one perfect match.
 </p>
 <p>
  There’s help. Edit distance algorithms, like
  <a href="http://en.wikipedia.org/wiki/Levenshtein_distance" title="Description of Levenshteins algorithm">
   Levenshtein’s
  </a>
  , can be used to measure how similar two strings really are. Matching then becomes finding the page with shortest distance from a list of its closest neighbors.
 </p>
 <p>
  Downside is that algorithm is fairly computationally expensive and it might take time to find a match. I’ll explore this problem in tomorrows article.
 </p>
 <p>
  <strong>
   Bad memory requests
  </strong>
 </p>
 <p>
  The main purpose of descriptive URLs is the same as catchy domain names. Make it easy to remember address for later use, when bookmarks or browsers autocomplete can’t be used.
 </p>
 <p>
  But memory is notoriously unreliable and it doesn’t work any better with web addresses. So addresses used may vary enough from the right one that they don’t get caught with edit distance algorithms. As an example, someone might try to access aforementioned Wikipedia’s article with:
 </p>
 <p style="text-indent:20pt;">
  http://en.wikipedia.org/wiki/Longest_subsequence_problem
 </p>
 <p>
  Calculated distance between this address and the real one is 7, which is probably more than would be real limit for matching. We can still look at referrer for clues, but we can also use requested address. In our case, we can extract keywords
  <em>
   longest
  </em>
  ,
  <em>
   subsequence
  </em>
  and
  <em>
   problem
  </em>
  and use them to search for possible hits. Wikipedia doesn’t do this either, but neither do I, so I shouldn’t complain.
  <br/>
  <strong>
   Time to wrap it up
  </strong>
 </p>
 <p>
  I believe this approaches make a good case for logical and descriptive addresses, since most of them don’t work (well) otherwise. If someone requests an article with a nonexistent ID 145, it’s impossible to resolve which of existing ones with IDs 155, 245 or 149 he really wanted.
 </p>
 <p>
  Still, sometimes descriptive addresses are not an option. I’d love to hear ideas or practical experience of how to handle such cases.
 </p>
</div>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2006-11-08T12:31:00+01:00">Wed 08 November 2006</time> </li>
                    <li><a href="../handling-404.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>
        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="../preventing-javascript-download-on-mobile-web.html" rel="bookmark" title="Permalink to Preventing download of javascript on mobile web">Preventing download of javascript on mobile web</a></h1>

            <div class="entry-content post-text">
                <div>
 <p>
  Every year I spend a few weeks somewhere where internet connection is either slow or metered and expensive. Usually it’s both which makes me rather twitchy when it comes to big web page sizes. Yet I’m also certain that my new web home, however it may turn out at the end, will have a significant chunk of it written in Javascript. None of it necessary for working, but more than I’d probably like to download over flimsy mobile phone connection.
 </p>
 <p>
  The problem are not really old mobile browsers which don’t support Javascript. They won’t download any of it anyway. The question is how to prevent eager browsers, who would, from downloading this stuff when you don’t want them to. My first, rather primitive attempt was
  <a href="http://markos.gaivo.net/examples/envcheck/index.html" title="Demo of javascript ondemand loading depending on media">
   this demonstration
  </a>
  , which only works in Opera 9, Safari and Firefox, but most certainly doesn’t work in all browsers.
 </p>
 <p>
  What it does is check font size of a title and based on its value resolves which media style sheet was used. If it was
  <em>
   mobile.css
  </em>
  , which is used only when media is set to
  <em>
   handheld
  </em>
  , then it was probably done from a mobile environment, so it includes the mobile version of a Javascript or it could, if I wanted, none at all.
 </p>
 <p>
  There are several problems with this approach. First one is that it doesn’t recognize notebook users connecting over a  cellphone. It can’t really, since browser environment is literally the same, unless it would try to measure latency and bandwidth of page elements and guess from those results, which is neither easy nor reliable. 3G networks can be rather fast and have a better latency than a wired connection from somewhere like Tanzania.
 </p>
 <p>
  But let’s say we don’t care about this case. We can always turn Javascript off in Firefox if it’s important enough to us, which leads us to the next problem. Support for handheld media type is still rather spotty. If browser doesn’t support it, it may load the wrong style sheet if any at all and the wrong CSS value results in wrong turn in Javascript. However
  <em>
   handheld media
  </em>
  support is getting better. Since I decided from the start that my personal page is a good place where leading edge can also be a bit of bleeding one, that is good enough. On a different site this probably wouldn’t be true.
 </p>
 <p>
  So it sort of works in principle, but it is crude and error prone. Javascript check is not self-contained and I could easily break it by changing font size value of a title in CSS files while forgetting to do a corresponding correction in code. What would be much better is to learn from the browser which media types style sheets were actually used and act accordingly. Now that would be grand.
 </p>
 <p>
  There are two ways you could go about this. My first go was finding style nodes in DOM and looking at their
  <em>
   disabled
  </em>
  property, which is commonly used in style sheet switchers for turning sheets on and off. It doesn’t work, since ‘wrong’ media types in Firefox are ignored, not disabled. Their
  <em>
   disabled
  </em>
  value is still set to
  <em>
   false
  </em>
  .
 </p>
 <p>
  A proper way of doing it would be using DOM Style Sheets methods. Basic idea is to compare actual values as set in the page with values read from style sheets and resolving which ones were used. While not exactly trivial, by little forethought it can be made to work fine in Opera and Firefox. It can also work in Explorer using its own methods, but it’s a pain to make it  work in Safari, which in this case is not only an incompetent liar, it’s also lying in some weird accent. If you’d like to learn more about it, then there’s a
  <a href="http://www.howtocreate.co.uk/tutorials/javascript/domstylesheets" title="Problems with DOM Style Sheets use">
   great
  </a>
  page describing current state but the gist of it is that you can’t rely on methods being there and even when they are, in some form or another, they might not work reliably (Safari) or might produce weird results (yup, Safari again).
 </p>
 <p>
  Well, it could still work, but would require an unreasonable amount of code. Hence I made a different tradeoff, which can be seen
  <a href="http://markos.gaivo.net/examples/envcheck/index2.html" title="Second attempt">
   here
  </a>
  . A bit less automation for a lot less code. It keeps the idea of first demo with a small twist. First rule of every media style sheet targets the same element that gets created by Javascript if necessary and compares its font size value with those found in style sheets. It returns media types of all sheets where this value was found.
 </p>
 <p>
  The end result certainly isn’t perfect or pretty, but it keeps amount of bookkeeping to minimum and limited to CSS files. Even using a “safe” property like font size can lead to problems (e.g. 0.9em is sometimes interpreted as 0.90em), but nothing difficult to overcome.
 </p>
 <p>
  It might not be of production quality, but it will work as good starting point for further exploration.
 </p>
</div>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2006-10-29T21:55:00+01:00">Sun 29 October 2006</time> </li>
                    <li><a href="../preventing-javascript-download-on-mobile-web.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>

<ul class="paginator">
		<li class="newer">
        <a href="../author/markos53.html">&laquo; Newer</a>
		</li>
		<li class="current">
    54 / 121
		</li>
		<li class="older">
        <a href="../author/markos55.html">Older &raquo;</a>
		</li>
</ul>
</section><!-- /#content -->

    <footer>
        <ul>
            <li>&copy; 2005-2020 Marko Samastur</li>
						<li><a href="/articles/privacy-policy.html">Privacy policy</a></li>
            <li><a href="/articles/feeds/rss.xml" rel="alternate" title="A notch above a monkey Full RSS Feed">Entries feed</a></li>
        </ul>
        <a href="/" class="mini-logo">Back to homepage</a>
    </footer>
</body>
</html>