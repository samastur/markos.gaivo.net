<!DOCTYPE html>
<html lang="en">
<head>
          <title>A notch above a monkey</title>
        <meta charset="utf-8" />
        <link rel="shortcut icon" href="theme/img/markos.ico" />

        <link rel="stylesheet" type="text/css" href="theme/css/home.min.css" media="screen" title="Light theme" />
        <link rel="alternate stylesheet" type="text/css" href="theme/css/home_dark.min.css" media="screen" title="Dark theme" />

        <link href="/articles/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="A notch above a monkey Full Atom Feed" />
        <link href="/articles/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="A notch above a monkey Full RSS Feed" />
        <link href="/articles/feeds/python-web.atom.xml" type="application/atom+xml" rel="alternate" title="A notch above a monkey Categories Atom Feed" />




</head>

<body>
<header id="banner" class="body">
    <h1><a href="./">A notch above a monkey</a> &raquo; Beautiful Soup is beautiful again</h1>
</header><!-- /#banner -->

<section class="envelope">
    <article class="post">
        <header class="entry-title">
            <h1 class="entry-title">Beautiful Soup is beautiful again</h1>
         
        </header>

        <footer class="post-info">
            <ul>
                <li class="by">Written by: <a href="/">Marko Samastur</a></li>
                <li class="published">Published on: <time datetime="2005-09-06T10:16:00+02:00" pubdate>Tue 06 September 2005</time></li>
                <li class="categories">Category: Python, Web
                </li>
            </ul>

        </footer><!-- /.post-info -->

        <div class="post-text">
            <div>
 <p>
  This is probably the last part in series of post dealing with Beautiful Soup. At least for a while. Good news is, I found the bug that caused observed weird behavior and it was partly self-inflicted.
 </p>
 <p>
  My problem appeared, because I was using variables that resembled html tags (e.g. imgs, ul…) and didn’t put space after &lt; in statements as good practice dictates. So I  had statements like:
  <br/>
  <code>
   <br/>
   if (i&lt;imgs.length)
   <br/>
  </code>
 </p>
 <p>
  Beautiful Soup relies on
  <em>
   sgmllib.py
  </em>
  for processing of documents and it’s sgmllib that causes havoc by processing CDATA (found in script and style blocks), when it shouldn’t. But the problem is not really with sgmllib, which has a literal switch to turn processing off. It’s just that Beautiful Soup doesn’t use it.
 </p>
 <p>
  So fix is really adding one line
  <br/>
  <code>
   <br/>
   self.literal = 1
   <br/>
  </code>
  <br/>
  after
  <em>
   if
  </em>
  statement on line 835. Or
  <a href="http://markos.gaivo.net/blog/code/BeautifulSoup.py" title="Link to fixed version">
   downloading fixed version
  </a>
  .
 </p>
 <p>
  Reading source I also realized another potential pitfall. If you use javascript to inject javascript with document.write method, you’ll probably confuse sgmllib (and hence Beautiful Soup). When processing CDATA, it doesn’t try to understand it, it just copies data until it finds an endtag (&lt;/script&gt; in javascript’s case). But if you’re doing that, you have yourself to blame.
 </p>
 <p>
  <em>
   BeautifulSoup 2.1.1 is
   <a href="http://www.crummy.com/software/BeautifulSoup/index.html">
    out
   </a>
   , which fixes my bug and several others. So you better fetch that version.
  </em>
 </p>
</div>
        </div><!-- /.entry-content -->

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES * * */
            var disqus_shortname = 'markosgaivo';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </article>
</section>

    <footer>
        <ul>
            <li>&copy; 2005-2015 Marko Samastur</li>
            <li><a href="/articles/feeds/rss.xml" rel="alternate" title="A notch above a monkey Full RSS Feed">Entries feed</a></li>
        </ul>
        <a href="/"><img src="/img/markos_light_small_bg.png" alt="logo" class="mini-logo" /></a>
    </footer>
</body>
</html>