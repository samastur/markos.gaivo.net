<!DOCTYPE html>
<html lang="en">
<head>
        <title>A notch above a monkey</title>
        <meta charset="utf-8" />
				<meta name="viewport" content="width=device-width, initial-scale=1">

				<link rel="shortcut icon" href="/articles/theme/favicon/favicon.ico" />
				<link rel="apple-touch-icon-precomposed" sizes="57x57" href="/articles/theme/favicon/apple-touch-icon-57x57.png" />
				<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/articles/theme/favicon/apple-touch-icon-114x114.png" />
				<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/articles/theme/favicon/apple-touch-icon-72x72.png" />
				<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/articles/theme/favicon/apple-touch-icon-144x144.png" />
				<link rel="apple-touch-icon-precomposed" sizes="60x60" href="/articles/theme/favicon/apple-touch-icon-60x60.png" />
				<link rel="apple-touch-icon-precomposed" sizes="120x120" href="/articles/theme/favicon/apple-touch-icon-120x120.png" />
				<link rel="apple-touch-icon-precomposed" sizes="76x76" href="/articles/theme/favicon/apple-touch-icon-76x76.png" />
				<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/articles/theme/favicon/apple-touch-icon-152x152.png" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-196x196.png" sizes="196x196" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-96x96.png" sizes="96x96" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-32x32.png" sizes="32x32" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-16x16.png" sizes="16x16" />
				<link rel="icon" type="image/png" href="/articles/theme/favicon/favicon-128.png" sizes="128x128" />
				<meta name="application-name" content="Marko Samastur"/>
				<meta name="msapplication-TileColor" content="#FBF8E9" />
				<meta name="msapplication-TileImage" content="/articles/theme/favicon/mstile-144x144.png" />
				<meta name="msapplication-square70x70logo" content="/articles/theme/favicon/mstile-70x70.png" />
				<meta name="msapplication-square150x150logo" content="/articles/theme/favicon/mstile-150x150.png" />
				<meta name="msapplication-wide310x150logo" content="/articles/theme/favicon/mstile-310x150.png" />
				<meta name="msapplication-square310x310logo" content="/articles/theme/favicon/mstile-310x310.png" />

        <style>
/*
 * Icecream theme by Marko Samastur (markos@gaivo.net)
 *
 *
 * Color palette:
 * - dark blue: #30303c
 * - light yellow: fbf8e9
 * - link red: #980000
 * - link orange: #ffb665
 */
*{box-sizing:border-box}html,body{padding:0;margin:0;height:100%}body{position:relative;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:300;font-size:18px;line-height:1.333333}section,article,aside,header,footer{display:block}h1,h2,h3,h4,h5,h6{margin:1.5em 0;font-size:1.777777em;font-weight:200;line-height:1.5}a:visited,a{text-decoration:none}a:hover{text-decoration:underline}a img{border:0;margin-top:6px}img{max-width:100%}.envelope{position:relative;max-width:60em;width:calc(100% - 2em);margin:2em auto 0;padding:0 0 8em}body > footer{position:fixed;bottom:0;width:100%;height:6em;margin:0;padding:.5em 1em 0;font-size:.8em;text-align:center}body > footer ul{list-style-type:none;margin:0;padding:0}body > footer li{margin:.25em 0}@media (min-device-width:600px){body > footer{height:3em;text-align:left}body > footer ul{display:inline-block}body > footer li{display:inline-block;margin:.5em 2em 0 0}body > footer .mini-logo{float:right}}.about h1{margin:0}.about h2{margin-bottom:0}.about p{margin:1.333333em 0}aside{margin-bottom:2.666666em}aside .photo{max-width:100%;max-height:11.2em;margin:0 1em 8px 0;padding:3px}aside ul{list-style-type:none;margin:0 0 1.333333em;padding:0;overflow:hidden}aside .vcard li{float:none;margin:0}aside li{float:left;margin:.25em 8px 0 0.1em}aside p{margin:0}aside a.email{padding-left:20px;background:url(../img/email-16x16.png) no-repeat 0 0}aside a.website{padding-left:20px;background:url(../img/website-16x16.png) no-repeat 0 0}.elsewhere-links{padding:0 0 0 .5em;list-style-type:inherit}.elsewhere-links > li{float:none;list-style-type:'- '}@media (min-device-width:600px){aside{float:right;width:30%}.about{width:62%;max-width:60em}}body > header h1{font-size:1em;margin:0;padding:.666666em 1em;line-height:1}.post-text h2,.post-text h3{margin:1em 0;font-size:1.333333em;line-height:1}.post .entry-title{margin:1.3333333em 0 0}.post p{margin:1.333333em 0}.post .post-info ul{margin:0 0 2.666666em;padding-left:0}.post .post-info li{list-style-type:none}.post > footer li{font-variant:small-caps}@media (min-device-width:600px){.post .post-info{float:right;width:30%;margin-top:o}.post .post-info ul{margin-bottom:0}.post .post-text,.post #isso-thread{width:62%;max-width:60em}.post p:first-child{margin-top:0}}.posts h1{margin-bottom:0}.colophon h1{margin-top:0;font-size:1em;font-weight:300;line-height:1.333333;font-variant:small-caps}.colophon ul{list-style-type:none;margin:1.333333em 0;padding:0}.posts .entry-title{margin:2.666666em 0 0;font-size:1.333333em;line-height:1}.posts p{margin:1.333333em 0}.post-metadata ul{margin:1.333333em 0;padding-left:0;opacity:.8}.post-metadata li{list-style-type:none;display:inline-block;font-style:italic}.post-metadata li:first-child:after{content:" |"}.posts .paginator{margin-top:2.666666em;padding-left:0;text-align:center}.paginator li{list-style-type:none;display:inline-block;margin:0 .5em}@media (min-device-width:600px){.colophon{float:right;width:30%;margin-top:0}.hentry{width:62%;max-width:60em}nav + .hentry .entry-title{margin-top:0}}.error{text-align:left}.error img{max-width:100%;padding:3px}.imageR img{float:right;margin:.7em 0 .7em 1.5em;padding:3px}.imageL img{float:left;margin:.7em 1.5em .7em 0;padding:3px}.zemanta-related-title{font-size:1em;margin:2.8em 0 0}.zemanta-img .wp-caption{margin:0 0 0 1.5em}.zemanta-img img{padding:3px}.zemanta-pixie{display:none}.alignleft{float:left}.alignright{float:right}.aligncenter{text-align:center;max-width:100%}.alignleft img,img.alignleft,.alignright img,img.alignright,.aligncenter img,img.aligncenter{padding:3px}ol.code{font:normal 95%/110% Andale Mono,Courier,monospace;padding:5px;text-align:left}ol.code code{font:normal 98%/110% Andale Mono,Courier,monospace}.code li.tab1{padding-left:1em}.code li.tab2{padding-left:2em}.code li.tab3{padding-left:3em}.code li.tab4{padding-left:4em}.code li.tab5{padding-left:5em}.code li.tab6{padding-left:6em}.code li.download,.code li:nth-last-child(2){list-style-type:none}.highlight pre{overflow:auto}				</style>

				<style type="text/css" title="Light theme">
body {background-color: #fbf8e9;color: #30303c;}
body > footer a, body > footer a:visited {color: #ffb665;}
a, a:visited, a:hover {color: #980000;}
body > footer {background-color:#30303c;color:#fbf8e9;}
aside .photo, .error img, .alignleft img, img.alignleft, .alignright img, img.alignright, .aligncenter img, img.aligncenter,
.zemanta-img img, .imageR img, .imageL img {background-color:#fbf8e9;border:1px solid #30303c;}
.post header h1, .posts header h1, .posts > header h1 {border-bottom:1px solid #30303c;}
ol.code {border: 1px solid #30303c;}
body > footer .mini-logo {display: inline-block;width:97px;height:32px;border:0;background:url(theme/img/markos_dark_small_bg.png);overflow:hidden;text-indent:-400px;}
				</style>

				<style type="text/css" title="Dark theme">
body {background-color: #30303c;color: #fbf8e9;}
body > footer a, body > footer a:visited {color: #980000;}
a, a:visited, a:hover {color: #ffb665;}
body > footer {background-color:#fbf8e9;color:#30303c;}
aside .photo, .error img, .alignleft img, img.alignleft, .alignright img, img.alignright, .aligncenter img, img.aligncenter,
.zemanta-img img, .imageR img, .imageL img {background-color:#fbf8e9;}
.post header h1, .posts header h1, .posts > header h1 {border-bottom:1px solid #fbf8e9;}
ol.code {border: 1px solid #fbf8e9;}
body > footer .mini-logo {display: inline-block;width:97px;height:32px;border:0;background:url(theme/img/markos_light_small_bg.png);overflow:hidden;text-indent:-400px;}
				</style>

        <link href="/articles/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="A notch above a monkey Full Atom Feed" />
        <link href="/articles/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="A notch above a monkey Full RSS Feed" />
</head>

<body>


<section class="envelope posts">
    <header>
        <h1><a href="./">A notch above a monkey <strong></strong></a></h1>
    </header><!-- /#banner -->

    <nav class="colophon">
        <h1>By Marko Samastur</h1>
        <ul>
            <li><a href="/">About me</a></li>
            <li><a href="/articles/feeds/atom.xml">Subscribe</a></li>
        </ul>
    </nav>

        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="./comments-closed.html" rel="bookmark" title="Permalink to Comments closed">Comments closed</a></h1>

            <div class="entry-content post-text">
                <div>
 <p>
  <strong>
  </strong>
 </p>
 <p>
  Like
  <a href="http://www.tablix.org/~avian/blog/archives/2013/07/comments_closed/" title="Comments closed">
   Tomaž
  </a>
  I had to deal with a flood of comments lately, sadly mostly spam and they are simply taking too much time to clean up. I think I could catch most of them by sending whole comment to Google search, parsing response for excerpts and match for similarity.
 </p>
 <p>
  Regretfully I don’t have time to build this and it wouldn’t scale (I’m curious why Akismet doesn’t do something like that). So following Tomaž’s research my plan is to turn off comments until botnet learns comments here don’t work and then turn them back on. This shouldn’t take more than a couple of weeks.
 </p>
 <p>
  Until then you will need an account to comment which anyone is free to create (for now). Sorry.
 </p>
</div>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2013-07-20T21:39:00+02:00">Sat 20 July 2013</time> </li>
                    <li><a href="./comments-closed.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>
        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="./laughable-javascript-security.html" rel="bookmark" title="Permalink to Laughable Javascript security">Laughable Javascript security</a></h1>

            <div class="entry-content post-text">
                <div>
 <p>
  Building a secure web application is not easy, unless you also use 3rd party code such as Facebook’s Like widget in which case it is impossible. What you have is just an illusion of security, a door to abuse that you can’t even check if it is currently closed.
 </p>
 <p>
  Or that’s what I thought for years. A once substantiated belief that grew into an almost dogmatic certainty until I recently got a chance to revisit it when trying to design a secure Javascript-based web application living inside of a likely untrusted environment.
 </p>
 <p>
  There are obvious things you can do to protect your application such as delivery over secure connections and use of anonymous functions to sandbox your code from outside interference. However you will probably need to interact with external code at some point in which case is that
  <em>
   XMLHTTPRequest
  </em>
  object you are using really the built-in one or has it been replaced (cloaked) with an impostor object to perform
  <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">
   the man-in-the-middle attack
  </a>
  ?
 </p>
 <p>
  I don’t know of a way to check if an object is untouched. What is sometimes used instead is a
  <em>
   .toString
  </em>
  method which on functions and methods returns their source unless they are native to browser in which case it returns a string saying so.
 </p>
 <p>
  Since you can replace any attribute and method on any object some
  <a href="http://stackoverflow.com/questions/6598945/detect-if-function-is-native-to-browser#comment8044242_6599105">
   go even further
  </a>
  in search of a certainty and use
  <em>
   .toString
  </em>
  from the
  <em>
   Function
  </em>
  object.
 </p>
 <p>
  At first thought that looked clever until I came up with:
 </p>
 <ol class="code">
  <li>
   <code>
    &lt;!DOCTYPE HTML&gt;
   </code>
  </li>
  <li>
   <code>
    &lt;html lang="en"&gt;
   </code>
  </li>
  <li>
   <code>
    &lt;head&gt;
   </code>
  </li>
  <li class="tab1">
   <code>
    &lt;meta charset="UTF-8"&gt;
   </code>
  </li>
  <li class="tab1">
   <code>
    &lt;title&gt;Break check if function is native&lt;/title&gt;
   </code>
  </li>
  <li>
   <code>
    &lt;/head&gt;
   </code>
  </li>
  <li>
   <code>
    &lt;body&gt;
   </code>
  </li>
  <li class="tab1">
   <code>
    &lt;script&gt;
   </code>
  </li>
  <li>
   <code>
    (function () {
   </code>
  </li>
  <li class="tab1">
   <code>
    var toS = Function.prototype.toString,
   </code>
  </li>
  <li class="tab2">
   <code>
    pM_str = window.postMessage.toString();
   </code>
  </li>
  <li>
  </li>
  <li class="tab1">
   <code>
    Function.prototype.toString = function () {
   </code>
  </li>
  <li class="tab2">
   <code>
    return this === window.postMessage ? pM_str : toS.call(this);
   </code>
  </li>
  <li class="tab1">
   <code>
    }
   </code>
  </li>
  <li class="tab1">
   <code>
    window.postMessage = function () { console.log('Fake'); };
   </code>
  </li>
  <li>
   <code>
    })();
   </code>
  </li>
  <li class="tab1">
   <code>
    &lt;/script&gt;
   </code>
  </li>
  <li>
   <code>
    &lt;/body&gt;
   </code>
  </li>
  <li>
   <code>
    &lt;/html&gt;
   </code>
  </li>
  <li>
  </li>
  <li class="download">
   Download this code:
   <a href="http://markos.gaivo.net/blog/code/nativecheck.txt" title="Download the above code as a text file">
    /code/nativecheck.txt
   </a>
  </li>
 </ol>
 <p>
  The code above replaces
  <em>
   Function’s .toString
  </em>
  method with a one that lies when executed on an also cloaked
  <em>
   window.postMessage
  </em>
  . Instead of displaying source of the new
  <em>
   postMessage
  </em>
  it prints whatever browser would print for the original one.
 </p>
 <p>
  It simultaneously demonstrates how you can cloak native Javascript objects and hide that you are doing it. If you put malicious code into an anonymous function and remove
  <em>
   &lt;script&gt;
  </em>
  node that added it after it gets executed, then there is no way for scripts loading later to know that it happened. There will be no traces of crime.
 </p>
 <p>
  It might be difficult to cloak literals like {} and [], but you certainly can their methods so even if your code is wrapped in an anonymous function, it isn’t really secured from outside peeking and poking. Hence you even
  <strong>
   can’t trust your own code
  </strong>
  .
 </p>
 <p>
  Turns out that this particular dogma is also true. Depressing.
 </p>
</div>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2013-07-11T22:57:00+02:00">Thu 11 July 2013</time> </li>
                    <li><a href="./laughable-javascript-security.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>
        <article class="hentry">
            <h1 class="entry-title storytitle"><a href="./adieu-mes-amis.html" rel="bookmark" title="Permalink to Adieu mes amis">Adieu mes amis</a></h1>

            <div class="entry-content post-text">
                <div>
 <p>
  When I write here I mostly do it for me and I mean that in an almost literal sense. My readers were quiet and few. They were also mostly Google Reader users or at least that’s how I imagined them. I certainly was.
 </p>
 <p>
  Greader’s shutdown meant forgotten accounts would be wiped out together with ghostly presence of their long gone owners. Those still around would be looking for a new reading home and may have seen this as a good time for late spring feed pruning.
 </p>
 <p>
  I wanted to say good bye before they did, but got my timing horribly wrong. Delayed too long until server running this website died. By the time it was up again, Greader wasn’t anymore.
 </p>
 <p>
  Sometimes you get to the station too late. The train has left and goodbyes remain unsaid. But then I remember I never actually knew if anybody would be on that train. So nothing really changed.
 </p>
</div>
            </div><!-- /.entry-content -->

            <footer class="post-metadata">
                <ul>
                    <li>Published on <time datetime="2013-07-09T22:32:00+02:00">Tue 09 July 2013</time> </li>
                    <li><a href="./adieu-mes-amis.html">Add your comment</a></li>
                </ul>
            </footer>
        </article>

<ul class="paginator">
		<li class="newer">
        <a href="./index11.html">&laquo; Newer</a>
		</li>
		<li class="current">
    12 / 119
		</li>
		<li class="older">
        <a href="./index13.html">Older &raquo;</a>
		</li>
</ul>
</section><!-- /#content -->

    <footer>
        <ul>
            <li>&copy; 2005-2020 Marko Samastur</li>
						<li><a href="/articles/privacy-policy.html">Privacy policy</a></li>
            <li><a href="/articles/feeds/rss.xml" rel="alternate" title="A notch above a monkey Full RSS Feed">Entries feed</a></li>
        </ul>
        <a href="/" class="mini-logo">Back to homepage</a>
    </footer>
</body>
</html>