<!DOCTYPE html>
<html lang="en">
<head>
	<title>A notch above a monkey &raquo; Using canvas and Javascript to blur images</title>
	<meta charset="utf-8" />
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0" /> 

	<link rel="shortcut icon" href="/img/markos.ico" />
	
	<meta name="generator" content="WordPress 3.0.5" /> <!-- leave this for stats please -->

	<link href="http://fast.fonts.com/cssapi/aee9b60b-8e94-47f8-b586-3ecbfab51d1c.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" type="text/css" href="css/home.css" media="screen" title="Light theme" />
	<link rel="alternate stylesheet" type="text/css" href="css/home_dark.css" media="screen" title="Dark theme" />
	<link rel="stylesheet" href="css/ipad.css" media="only screen and (min-device-width : 768px) and (max-device-width : 1024px)">
	<link rel="stylesheet" type="text/css" href="css/smallscreen.css" media="only screen and (max-width: 700px)" />

	<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://markos.gaivo.net/blog/?feed=rss2" />
	<link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="http://markos.gaivo.net/blog/?feed=atom" />
	<link rel='canonical' href='http://markos.gaivo.net/blog/?p=664' />

	<link rel="pingback" href="http://markos.gaivo.net/blog/xmlrpc.php" />

	<link rel="alternate" type="application/rss+xml" title="A notch above a monkey &raquo; Using canvas and Javascript to blur images Comments Feed" href="http://markos.gaivo.net/blog/?feed=rss2&amp;p=591" />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://markos.gaivo.net/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://markos.gaivo.net/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='A notch above a monkey' href='http://markos.gaivo.net/blog' />
<link rel='start' title='First post' href='http://markos.gaivo.net/blog/?p=2' />
<link rel='prev' title='My prototypes on YouTube' href='http://markos.gaivo.net/blog/?p=588' />
<link rel='next' title='EuroPython submission deadline is around the corner' href='http://markos.gaivo.net/blog/?p=596' />
<meta name="generator" content="WordPress 3.0.5" />
<link rel='canonical' href='http://markos.gaivo.net/blog/?p=591' />

	<!--[if lt IE 9]>
	<script src="/js/html5.js"></script>
	<![endif]-->
</head>
<body>
					<header>
		<h1><a href="/blog/">A notch above a monkey</a> &raquo; Using canvas and Javascript to blur images</h1>
	</header>

	<section class="envelope">
		<article class="post">
			<header>
				<h1>Using canvas and Javascript to blur images</h1>
			</header>

			<footer>
				<ul>
					<li class="by">Written by: <a href="/">Marko Samastur</a></li>
					<li class="published">Published on: <time datetime="2010-04-01T10:59:34+00:00" pubdate>April 1, 2010</time></li>
					<li class="categories">Categories: <a href="http://markos.gaivo.net/blog/?cat=1" title="View all posts in Javascript" rel="category">Javascript</a>, <a href="http://markos.gaivo.net/blog/?cat=4" title="View all posts in Web" rel="category">Web</a></li>
					<li class="post-comments">Comments: <a href="http://markos.gaivo.net/blog/?p=591#comments" title="Comment on Using canvas and Javascript to blur images">9</a></li>
				</ul>
			</footer>

			<div class="post-text">
				<p>I admire the look and feel of <a href="http://www.mikematas.com/">Mike Matas&#8217; new website</a>. It is really well thought through. I was also intrigued by how he did it, especially after getting a pop-up on my first visit advising me to use a more modern browser than a recent version of Firefox.</p>
<p>There is no point in speculating why some of its features don&#8217;t work in more browsers. But I was surprised to see that blurred images are served that way and don&#8217;t get blurred in browser. I am playing with an idea of implementing a gallery inspired by Mike&#8217;s work, but I would like to reduce manual labor needed for maintaining it.</p>
<p>So I wrote a function that blurs an image on canvas. You can <a title="Javascript blur demo page" href="http://markos.gaivo.net/examples/canvas_blur/">see it in action</a> or copy its code, if you find it useful.</p>
<p>The algorithm used is described in <a title="Link to PDF version of paper" href="http://web.archive.org/web/20060718054020/http://www.acm.uiuc.edu/siggraph/workshops/wjarosz_convolution_2001.pdf">2001 paper</a> by Wojciech Jarosz. Page contains two implementations, second trading algorithm purity for in my opinion nicer code. Increase number of passes or run it few times over an image, if you need a blurrier result.? Please ask, if you need help with its use.</p>
<p>I also measured its speed to see if it fits my needs. That brought a new surprise. Firefox 3.5.8? on my Linux powered VAIO with 1.2GHz processor blurs image twice as fast as same browser on a Mac with a 2.8Ghz processor. Numbers between runs may vary slightly, but never much. No idea why this is happening, since all functions do is some basic math over items in array that should be well optimized everywhere.</p>
<p>I am sure somebody can optimize it further, but I find it good enough for my use. Image isn&#8217;t very blurred after one pass, but one pass over a small image is also a good way to measure how fast a particular computer-browser combination is. On fast combinations I might go for multiple passes over images in view, but fall back to a single pass or no pass on slower systems.</p>
<div class="zemanta-pixie"><a class="zemanta-pixie-a" title="Reblog this post [with Zemanta]" href="http://reblog.zemanta.com/zemified/4b7c629c-fdbe-4190-ade4-e240b1b3755a/"><img class="zemanta-pixie-img" src="http://img.zemanta.com/reblog_e.png?x-id=4b7c629c-fdbe-4190-ade4-e240b1b3755a" alt="Reblog this post [with Zemanta]" /></a></div>
			</div>

			<nav>
				<p>If you liked this, you might want to visit:</p>
				<ul>
					<li>my previous article: <a href="http://markos.gaivo.net/blog/?p=588" rel="prev">My prototypes on YouTube</a></li>					<li>my next article: <a href="http://markos.gaivo.net/blog/?p=596" rel="next">EuroPython submission deadline is around the corner</a></li>					<li><a href="/blog/">article list</a></li>
				</ul>
			</nav>

			<h2 id="comments">Comments (9)
			</h2>
			<ol class="comments">
		
				<li id="comment-209898">
					<article>
						<p>cool and useful</p>
						<footer>
							<cite>Comment by <a href='http://xrado.hopto.org' rel='external nofollow' class='url'>xrado</a> &#8212; <time datetime="2010-04-02T09:42:26+00:00">April 2, 2010 @ 9:42 am</time> <a href="#comment-209898">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-214790">
					<article>
						<p>What would it take to do this automatically for several images on a page load?<br />
This is a really interesting effect.</p>
						<footer>
							<cite>Comment by <a href='http://www.flavors.me/noods' rel='external nofollow' class='url'>Dan</a> &#8212; <time datetime="2010-07-22T00:48:47+00:00">July 22, 2010 @ 12:48 am</time> <a href="#comment-214790">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-214808">
					<article>
						<p>Depends on page, but probably easiest would be to create a canvas for each image and blur image on it.</p>
						<footer>
							<cite>Comment by <a href='http://markos.gaivo.net' rel='external nofollow' class='url'>markos</a> &#8212; <time datetime="2010-07-22T10:55:59+00:00">July 22, 2010 @ 10:55 am</time> <a href="#comment-214808">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-216752">
					<article>
						<p>Too bad it isn&#8217;t probably ready for prime time. Browsers aren&#8217;t optimized enough. Mike&#8217;s website was not smooth enough to be functional on Chrome 5 on a 2.8Ghz Mac, which should perform better than 80% (made-up) of the other machines around the world, so unless these hardware-accelerated engines see the light I doubt we can use this while providing an optimal experience.</p>
<p>I mean, have you seen this? (Flash)<br />
<a href="http://www.adobe.com/jp/events/cs3_web_edition_tour/swfs/perform.swf">http://www.adobe.com/jp/events/cs3_web_edition_tour/swfs/perform.swf</a></p>
<p>That&#8217;s &#8220;fast enough&#8221;</p>
						<footer>
							<cite>Comment by <a href='http://bfred.it' rel='external nofollow' class='url'>bfred.it</a> &#8212; <time datetime="2010-09-01T03:09:20+00:00">September 1, 2010 @ 3:09 am</time> <a href="#comment-216752">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-217127">
					<article>
						<p>May be, but problem with Mike&#8217;s site isn&#8217;t blur or even Javascript itself. I am still building my gallery, but it seems to handle couple of hundred images quite well.</p>
<p>I tried to look at your link on my iPad, but couldn&#8217;t see anything <img src='http://markos.gaivo.net/blog/wp-includes/images/smilies/icon_razz.gif' alt=':P' class='wp-smiley' />  Seriously though, Flash is (for now) indispensable tool for some tasks, but there are fewer of them each day.</p>
						<footer>
							<cite>Comment by <a href='http://markos.gaivo.net' rel='external nofollow' class='url'>markos</a> &#8212; <time datetime="2010-09-10T18:48:22+00:00">September 10, 2010 @ 6:48 pm</time> <a href="#comment-217127">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-219402">
					<article>
						<p>I have optimized it, and made a new version that takes about 6/10 as long un minified, and about 1/2 as long minified (using google Closure Compiler)</p>
<p>here it is unminified:</p>
<p>function blur (img, passes) {<br />
	var i, j, k, w = img.width, h = img.height, im = img.data, m=2, temp, pos, poss, step, jump, inner, outer, arr;</p>
<p>		while(m&#8211;) {<br />
			if (m) {<br />
				outer = w; inner = h;<br />
				step = w&lt;&lt;2;<br />
			} else {<br />
				outer = h; inner = w;<br />
				step = 4;<br />
			}<br />
			i=outer;<br />
			while(i&#8211;) {<br />
				jump = m===0 ? i*w&lt;&lt;2 : i&lt;&gt;2)|0;<br />
					im[poss+step] =((arr += im[poss+step*3])/5)|0;<br />
					for (j = 3; j 0?temp:0)/5)|0;<br />
					}<br />
					im[pos+j*step] = ((arr -= im[pos+(j-2)*step])&gt;&gt;2)|0;<br />
					im[pos+(j+1)*step] =((arr -= im[pos+(j-1)*step])/3)|0;<br />
				}<br />
			}<br />
                }<br />
	return img;<br />
}<br />
Minified:<br />
function blur(g){;for(var e,a,i,h=g.width,l=g.height,b=g.data,j=2,m,d,c,n,k,f;j&#8211;;){if(j){e=h;k=l;c=h&lt;&lt;2}else{e=l;k=h;c=4}for(e=e;e&#8211;;){n=j===0?e*h&lt;&lt;2:e&lt;&gt;2|0;b[a+c]=(f+=b[a+c*3])/5|0;for(a=3;a0?m:0)/5|0;b[d+a*c]=(f-=b[d+(a-2)*c])&gt;&gt;2|0;b[d+(a+1)*c]=(f-b[d+(a-1)*c])/3|0}}};return g};</p>
						<footer>
							<cite>Comment by <a href='http://a.com' rel='external nofollow' class='url'>bob</a> &#8212; <time datetime="2010-11-01T02:03:14+00:00">November 1, 2010 @ 2:03 am</time> <a href="#comment-219402">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-219404">
					<article>
						<p>on my following script, it always does one pass. i am using it in a loop, so i saw it unnecessary.</p>
						<footer>
							<cite>Comment by <a href='http://a.com' rel='external nofollow' class='url'>bob</a> &#8212; <time datetime="2010-11-01T02:09:19+00:00">November 1, 2010 @ 2:09 am</time> <a href="#comment-219404">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-220335">
					<article>
						<p>Thanks for sharing !</p>
						<footer>
							<cite>Comment by <a href='http://twitter.com/aforavi' rel='external nofollow' class='url'>Avinash</a> &#8212; <time datetime="2010-11-22T08:27:57+00:00">November 22, 2010 @ 8:27 am</time> <a href="#comment-220335">#</a> </cite>
						</footer>
					</article>
				</li>
		
				<li id="comment-223239">
					<article>
						<p>[...] though it could also be done in JavaScript using a canvas tag and getImageData(), for example: <a href="http://markos.gaivo.net/blog/?p=591Insert">http://markos.gaivo.net/blog/?p=591Insert</a> a dynamic date hereCannot add comment at this [...]</p>
						<footer>
							<cite>Pingback by <a href='http://www.quora.com/What-web-technologies-is-mikematas-com-built-with#ans244903' rel='external nofollow' class='url'>What web technologies is mikematas.com built with? - Quora</a> &#8212; <time datetime="2011-01-07T21:57:02+00:00">January 7, 2011 @ 9:57 pm</time> <a href="#comment-223239">#</a> </cite>
						</footer>
					</article>
				</li>
		
			</ol>


		<p>Sorry, the comment form is closed at this time.</p>

		</article>
	</section>
			<!-- All pages -->
	

	<footer>
		<ul>
			<li>&copy; 2005-2015 Marko Samastur</li>
			
			<li><a href="http://markos.gaivo.net/blog/?feed=rss2">Entries feed</a></li>
			<li><a href="http://markos.gaivo.net/blog/?feed=comments-rss2">Comments feed</a></li>
		</ul>
		<a href="/"><img src="/img/markos_light_small_bg.png" alt="logo" class="mini-logo" /></a>
	</footer>
	<!-- Google analytics -->
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-152438-1']);
	  _gaq.push(['_trackPageview']);
	</script>
	<script src="/js/cookie.js"></script>
</body>
</html>
